<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>SCTrack.reclassification</title>
    
          <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/theme.css " type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="../../_static/theme-vendors.js"></script> -->
      <script src="../../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../../index.html" class="home-link">
    
      <span class="site-name">SC-Track</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../../modules.html#sctrack"
         class="nav-link ">
         sctrack
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../python_apis/modules.html#sctrack"
         class="nav-link ">
         sctrack
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../../modules.html#sctrack"
         class="nav-link ">
         sctrack
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../python_apis/modules.html#sctrack"
         class="nav-link ">
         sctrack
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="../../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../modules.html#sctrack">sctrack</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../SCTrack.html" class="reference internal ">SCTrack package</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../python_apis/modules.html#sctrack">sctrack</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../python_apis/SCTrack.html" class="reference internal ">SCTrack package</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
    
      <li><a href="../index.html">Module code</a> &raquo;</li>
    
    <li>SCTrack.reclassification</li>
  </ul>
  

  <ul class="page-nav">
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <h1>Source code for SCTrack.reclassification</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">tifffile</span>
<span class="kn">from</span> <span class="nn">imagesize</span> <span class="kn">import</span> <span class="n">imagesize</span>

<span class="kn">from</span> <span class="nn">SCTrack.base</span> <span class="kn">import</span> <span class="n">Cell</span>
<span class="kn">from</span> <span class="nn">SCTrack.tracker</span> <span class="kn">import</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">CellNode</span><span class="p">,</span> <span class="n">TrackingTree</span>
<span class="kn">from</span> <span class="nn">SCTrack.config</span> <span class="kn">import</span> <span class="n">RAW_INPUT_IMAGE_SIZE</span>
<span class="kn">from</span> <span class="nn">SCTrack.config</span> <span class="kn">import</span> <span class="n">N_CLASS</span><span class="p">,</span> <span class="n">CLASS_NAME</span>
<span class="kn">from</span> <span class="nn">SCTrack</span> <span class="kn">import</span> <span class="n">config</span>


<div class="viewcode-block" id="TreeParser"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser">[docs]</a><span class="k">class</span> <span class="nc">TreeParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;parse TrackingTree&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_tree</span><span class="p">:</span> <span class="n">TrackingTree</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">track_tree</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineage_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># {cells: [children_list], branch_id: &#39;&#39;ï¼Œ &#39;G1_start&#39;: &#39;&#39;, &#39;S_start&#39;: &#39;&#39;, &#39;G2_start&#39;: &#39;&#39;, &#39;M1_start&#39;: &#39;&#39;, &#39;M2_start&#39;: &#39;&#39;}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_parent_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_root_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_mitosis_flag</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_s_flag</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_flag</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__division_count</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="TreeParser.record_cell_division_count"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.record_cell_division_count">[docs]</a>    <span class="k">def</span> <span class="nf">record_cell_division_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__division_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__division_count</span></div>

<div class="viewcode-block" id="TreeParser.get_child"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.get_child">[docs]</a>    <span class="k">def</span> <span class="nf">get_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">CellNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">CellNode</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all child nodes according to the parent node, including only direct child nodes&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="TreeParser.search_root_node"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.search_root_node">[docs]</a>    <span class="k">def</span> <span class="nf">search_root_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the root node of each generation of cells, that is, the first node of each branch of TrackingTree</span>
<span class="sd">        This method is to deal with the situation where mitosis occurs, that is, the tree begins to branch</span>
<span class="sd">        When the cell begins to undergo mitosis, the tree will split, record the node at this time, and backtrack</span>
<span class="sd">        as a generation of cells</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">branch_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">root_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">root_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_cell_id</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">track_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">branch_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineage_dict</span><span class="p">[</span><span class="n">root_node</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cells&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">root_node</span><span class="p">],</span> <span class="s1">&#39;branch_id&#39;</span><span class="p">:</span> <span class="n">root_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">branch_id</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loop_queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">root_node</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">loop_queue</span><span class="p">:</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">loop_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">next_node</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">:</span>
                    <span class="n">loop_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_node</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">record_cell_division_count</span><span class="p">()</span>
                    <span class="c1"># if current not in self.lineage_dict or current in self.lineage_dict:  # not useful branch</span>
                    <span class="k">for</span> <span class="n">child_cell</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lineage_dict</span><span class="p">[</span><span class="n">child_cell</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cells&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">child_cell</span><span class="p">],</span>
                                                         <span class="s1">&#39;branch_id&#39;</span><span class="p">:</span> <span class="n">child_cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">branch_id</span><span class="p">,</span>
                                                         <span class="s1">&#39;branch_start&#39;</span><span class="p">:</span> <span class="n">child_cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="n">current</span><span class="p">}</span>
                        <span class="k">if</span> <span class="n">child_cell</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">:</span>
                            <span class="n">branch_id</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">child_cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_cell_id</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">track_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">branch_id</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">root_parent_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child_cell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_root_flag</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TreeParser.parse_lineage"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.parse_lineage">[docs]</a>    <span class="k">def</span> <span class="nf">parse_lineage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the cell node sequence contained in each branch&quot;&quot;&quot;</span>
        <span class="n">loop_queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">root_node</span><span class="p">]</span>
        <span class="n">last_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">loop_queue</span><span class="p">:</span>
            <span class="n">current_node</span> <span class="o">=</span> <span class="n">loop_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">last_node</span> <span class="o">=</span> <span class="n">current_node</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">current_node</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">loop_node</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">:</span>
                <span class="n">loop_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop_node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineage_dict</span><span class="p">[</span><span class="n">root_node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lineage_dict</span><span class="p">[</span><span class="n">root_node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_node</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineage_dict</span><span class="p">[</span><span class="n">root_node</span><span class="p">][</span><span class="s1">&#39;branch_end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="TreeParser.get_lineage_dict"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.get_lineage_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_lineage_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_root_flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_root_node</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_lineage</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_mitosis_flag</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineage_dict</span></div>

<div class="viewcode-block" id="TreeParser.bfs"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.bfs">[docs]</a>    <span class="k">def</span> <span class="nf">bfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Traverse TrackingTree according to breadth first&quot;&quot;&quot;</span>
        <span class="n">root_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loop_queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">root_node</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">loop_queue</span><span class="p">:</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">loop_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">loop_node</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">:</span>
                    <span class="n">loop_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop_node</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">ch</span></div>

<div class="viewcode-block" id="TreeParser.check_mitosis_start"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.check_mitosis_start">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">check_mitosis_start</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">lineage_cell</span><span class="p">,</span> <span class="n">area_size_t</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">mitosis_gap</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">m_predict_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the entry of the M period, if the area meets the conditions, check the next frame, if the area of the next</span>
<span class="sd">        frame is too small, it is not considered to have entered, and it is judged as a segmentation misjudgment.</span>
<span class="sd">        If the check is passed, check the next 6 frames. If the number of M phases is predicted to be greater than or</span>
<span class="sd">        equal to the threshold, it is judged to enter the M cell_type to pass, otherwise, the judgment fails.</span>
<span class="sd">        If the interval from the last entry to M is too short, it is also considered a misjudgment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">predict_enter_cell</span> <span class="o">=</span> <span class="n">lineage_cell</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span>
        <span class="n">next_cell</span> <span class="o">=</span> <span class="n">lineage_cell</span><span class="p">[</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lineage_cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span> <span class="ow">and</span> <span class="n">start_index</span> <span class="o">&lt;</span> <span class="n">mitosis_gap</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">next_cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">predict_enter_cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">area</span> <span class="o">&lt;</span> <span class="n">area_size_t</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">predict_m_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineage_cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">start_index</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineage_cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">start_index</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">lineage_cell</span><span class="p">[</span><span class="n">start_index</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                    <span class="n">predict_m_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">predict_m_count</span> <span class="o">&gt;=</span> <span class="n">m_predict_threshold</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TreeParser.check_ctype_start"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.check_ctype_start">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">check_ctype_start</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">linage_cell</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">PROB_THRESHOLD</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">SMOOTH_WINDOW_LEN</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the entry of cell_type, if the cell is predicted to be in indicate cell_type, check 10 frames later,</span>
<span class="sd">        If the number of remaining frames is less than 10 frames, check all the remaining frames.</span>
<span class="sd">        If the cumulative predicted indicate cell type is greater than the threshold,</span>
<span class="sd">        If the judgment succeeds, otherwise, the judgment fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">linage_cell</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">==</span> <span class="n">type_name</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">SMOOTH_WINDOW_LEN</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">linage_cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">start_index</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">linage_cell</span><span class="p">[</span><span class="n">start_index</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">==</span> <span class="n">type_name</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TreeParser.check_ctype_exit"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.check_ctype_exit">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">check_ctype_exit</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">end_index</span><span class="p">,</span> <span class="n">linage_cell</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">PROB_THRESHOLD</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">SMOOTH_WINDOW_LEN</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To judge the exit of cell_type, the judgment principle is the same as entering  cell_type,</span>
<span class="sd">        if the cells start to exit cell_type, check later</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">non_type_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">linage_cell</span><span class="p">[</span><span class="n">end_index</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">!=</span> <span class="n">type_name</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">SMOOTH_WINDOW_LEN</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">linage_cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">end_index</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">linage_cell</span><span class="p">[</span><span class="n">end_index</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">!=</span> <span class="n">type_name</span><span class="p">:</span>
                    <span class="n">non_type_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">non_type_count</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TreeParser.parse_mitosis"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.parse_mitosis">[docs]</a>    <span class="k">def</span> <span class="nf">parse_mitosis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">CellNode</span><span class="p">,</span> <span class="n">lineage_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse entry and exit of mitosis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">area_size_t</span> <span class="o">=</span> <span class="mf">1.4</span>
        <span class="n">cell_node_line</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
        <span class="n">mitosis_start_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">exist_m_frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">before_cell_node</span> <span class="o">=</span> <span class="n">cell_node_line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">current_cell_node</span> <span class="o">=</span> <span class="n">cell_node_line</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># print(f&#39;{current_cell_node.cell.area / before_cell_node.cell.area:.2f}&#39;)</span>
            <span class="k">if</span> <span class="n">before_cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                <span class="n">exist_m_frame</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">current_cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">before_cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">area</span> <span class="o">&gt;=</span> <span class="n">area_size_t</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_mitosis_start</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cell_node_line</span><span class="p">,</span> <span class="n">m_predict_threshold</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">PROB_THRESHOLD</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">SMOOTH_WINDOW_LEN</span><span class="p">):</span>
                    <span class="n">mitosis_start_index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="n">before_cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span> <span class="ow">and</span> <span class="n">current_cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">before_cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">area</span> <span class="o">&lt;</span> <span class="n">area_size_t</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_mitosis_start</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cell_node_line</span><span class="p">,</span> <span class="n">m_predict_threshold</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">PROB_THRESHOLD</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">SMOOTH_WINDOW_LEN</span><span class="p">):</span>
                    <span class="n">mitosis_start_index</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">mitosis_start_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">exist_m_frame</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">cell_node</span> <span class="ow">in</span> <span class="n">cell_node_line</span><span class="p">:</span>
                        <span class="n">cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>
                    <span class="n">lineage</span><span class="p">[</span><span class="s1">&#39;m2_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lineage_index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">cell_node</span> <span class="ow">in</span> <span class="n">cell_node_line</span><span class="p">[:</span> <span class="mi">3</span><span class="p">]:</span>
                        <span class="n">cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>
                    <span class="n">lineage</span><span class="p">[</span><span class="s1">&#39;m1_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mitosis_start_index</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)):</span>
                <span class="n">cell_node_line</span><span class="p">[</span><span class="n">m_index</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>
            <span class="n">lineage</span><span class="p">[</span><span class="s1">&#39;m2_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mitosis_start_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_mitosis_flag</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TreeParser.parse_s"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.parse_s">[docs]</a>    <span class="k">def</span> <span class="nf">parse_s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">CellNode</span><span class="p">,</span> <span class="n">lineage_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To judge the entry of S cell_type&quot;&quot;&quot;</span>
        <span class="n">cell_node_line</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
        <span class="n">s_start_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">s_exit_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_mitosis_flag</span><span class="p">[</span><span class="n">root</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_mitosis</span><span class="p">(</span><span class="n">lineage</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">lineage_index</span><span class="o">=</span><span class="n">lineage_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;m1_start&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">check_start</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;m1_start&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">check_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cell_node_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">check_start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">cell_node_line</span><span class="p">[</span><span class="n">cell_node_index</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ctype_start</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">cell_node_index</span><span class="p">,</span> <span class="n">cell_node_line</span><span class="p">):</span>
                    <span class="n">lineage</span><span class="p">[</span><span class="s1">&#39;s_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_start_index</span> <span class="o">=</span> <span class="n">cell_node_index</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">s_start_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cell_node_index_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s_start_index</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">cell_node_line</span><span class="p">[</span><span class="n">cell_node_index_2</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">!=</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ctype_exit</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">cell_node_index_2</span><span class="p">,</span> <span class="n">cell_node_line</span><span class="p">):</span>
                        <span class="n">lineage</span><span class="p">[</span><span class="s1">&#39;s_exit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_exit_index</span> <span class="o">=</span> <span class="n">cell_node_index_2</span>
                        <span class="k">break</span>

        <span class="k">if</span> <span class="n">s_start_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s_exit_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">s_exit_index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_node_index_s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s_start_index</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                <span class="n">cell_node_line</span><span class="p">[</span><span class="n">cell_node_index_s</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_s_flag</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TreeParser.parse_g1_g2"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.parse_g1_g2">[docs]</a>    <span class="k">def</span> <span class="nf">parse_g1_g2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">CellNode</span><span class="p">,</span> <span class="n">lineage_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Accurately distinguish G1/G2 into G1, G2&quot;&quot;&quot;</span>
        <span class="n">cell_node_line</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
        <span class="n">g1_start_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">g1_exit_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">g2_start_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">g2_exit_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">m1_start</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;m1_start&#39;</span><span class="p">)</span>
        <span class="n">m2_start</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;m2_start&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_s_flag</span><span class="p">[</span><span class="n">root</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_s</span><span class="p">(</span><span class="n">lineage</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;s_start&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># 1. track starts from  S</span>
            <span class="c1"># 2. track starts from G1 cell_type</span>
            <span class="c1"># 3. The track starts from the M1</span>
            <span class="n">g1_exit_index</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;s_start&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m1_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">g1_start_index</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g1_start_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;s_exit&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">g2_start_index</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;s_exit&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m2_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">g2_exit_index</span> <span class="o">=</span> <span class="n">m2_start</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">g2_exit_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># cells are not in S cell_type</span>
            <span class="c1"># 1. The track starts from the M1 period and does not enter the S cell_type</span>
            <span class="c1"># 2. The track starts from the G1 cell_type and does not enter the S cell_type</span>
            <span class="c1"># 3. The track starts from the G2 period and enters the M2 cell_type</span>
            <span class="c1"># 3. The track starts from the G2 period and does not enter the M2 cell_type</span>
            <span class="k">if</span> <span class="n">m2_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">g2_start_index</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">g2_exit_index</span> <span class="o">=</span> <span class="n">m2_start</span>
            <span class="k">elif</span> <span class="n">m1_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">g1_start_index</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="n">g1_exit_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lineage_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">g1_start_index</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">g1_exit_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">g2_start_index</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">g2_exit_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">g1_start_index</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">g1_exit_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g1_start_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lineage</span><span class="p">[</span><span class="s1">&#39;g1_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g1_start_index</span>
            <span class="k">if</span> <span class="n">g1_exit_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">g1_exit_index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_node_index_g1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g1_start_index</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                <span class="n">cell_node_line</span><span class="p">[</span><span class="n">cell_node_index_g1</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;G1&#39;</span>
        <span class="k">if</span> <span class="n">g2_start_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lineage</span><span class="p">[</span><span class="s1">&#39;g2_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g2_start_index</span>
            <span class="k">if</span> <span class="n">g2_exit_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">end_2</span> <span class="o">=</span> <span class="n">g2_exit_index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end_2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_node_index_g2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g2_start_index</span><span class="p">,</span> <span class="n">end_2</span><span class="p">):</span>
                <span class="n">cell_node_line</span><span class="p">[</span><span class="n">cell_node_index_g2</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;G2&#39;</span></div>

<div class="viewcode-block" id="TreeParser.parse_mitosis_error"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.parse_mitosis_error">[docs]</a>    <span class="k">def</span> <span class="nf">parse_mitosis_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">CellNode</span><span class="p">,</span> <span class="n">lineage_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the two daughter cells after division are not matched, all subsequent cells will be in the M cell_type.</span>
<span class="sd">        At this time, it should be corrected to G1 within a certain period of time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell_node_line</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
        <span class="n">m1_start</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;m1_start&#39;</span><span class="p">)</span>
        <span class="n">m2_start</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;m2_start&#39;</span><span class="p">)</span>
        <span class="n">m_count</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="n">m1_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m_start</span> <span class="o">=</span> <span class="n">m1_start</span>
        <span class="k">elif</span> <span class="n">m2_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m_start</span> <span class="o">=</span> <span class="n">m2_start</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m_start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">cell_node_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                <span class="n">m_count</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">m_count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cell_node_line</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;G1&#39;</span></div>

<div class="viewcode-block" id="TreeParser.set_cell_id"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.set_cell_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">CellNode</span><span class="p">,</span> <span class="n">lineage_index</span><span class="p">):</span>
        <span class="n">cell_node_line</span> <span class="o">=</span> <span class="n">lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
        <span class="n">branch_id</span> <span class="o">=</span> <span class="n">lineage_index</span>
        <span class="n">cell_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">track_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">branch_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lineage_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_cell_id</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span>
            <span class="n">root</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_branch_id</span><span class="p">(</span><span class="n">branch_id</span><span class="p">)</span>
            <span class="n">lineage</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">lineage</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_cell_id</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_id</span><span class="p">)</span>
            <span class="c1"># parent.cell.set_cell_id(cell_id)</span>
            <span class="c1"># parent.cell.set_branch_id(branch_id)</span>
        <span class="k">for</span> <span class="n">cell_node</span> <span class="ow">in</span> <span class="n">cell_node_line</span><span class="p">:</span>
            <span class="n">cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_cell_id</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span>
            <span class="n">cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_branch_id</span><span class="p">(</span><span class="n">branch_id</span><span class="p">)</span>
            <span class="n">cell_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_track_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">track_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TreeParser.parse_lineage_phase"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.parse_lineage_phase">[docs]</a>    <span class="k">def</span> <span class="nf">parse_lineage_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">CellNode</span><span class="p">,</span> <span class="n">linage_index</span><span class="p">):</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_mitosis</span><span class="p">(</span><span class="n">lineage</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">linage_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_s</span><span class="p">(</span><span class="n">lineage</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">linage_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_g1_g2</span><span class="p">(</span><span class="n">lineage</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">linage_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_mitosis_error</span><span class="p">(</span><span class="n">lineage</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">linage_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_id</span><span class="p">(</span><span class="n">lineage</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">linage_index</span><span class="p">)</span></div>

<div class="viewcode-block" id="TreeParser.parse_lineage_branch_id"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.parse_lineage_branch_id">[docs]</a>    <span class="k">def</span> <span class="nf">parse_lineage_branch_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineage</span><span class="p">,</span> <span class="n">branch_id</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="TreeParser.smooth_type"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.TreeParser.smooth_type">[docs]</a>    <span class="k">def</span> <span class="nf">smooth_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_lineage</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">lineage_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">N_CLASS</span> <span class="ow">and</span> <span class="n">CLASS_NAME</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">CLASS_NAME</span><span class="p">)</span> <span class="o">!=</span> <span class="n">N_CLASS</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;The number of category names and category numbers is not equal, &#39;</span>
                              <span class="s1">&#39;try to change N_CLASS OR CLASS_NAME&#39;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">if</span> <span class="n">CLASS_NAME</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">CLASS_NAME</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;G1&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;G2&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse_lineage_phase</span><span class="p">(</span><span class="n">cell_lineage</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">lineage_index</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">class_name</span> <span class="o">=</span> <span class="n">CLASS_NAME</span>
        <span class="k">elif</span> <span class="n">N_CLASS</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">):</span>
                <span class="n">class_name</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;N_CLASS and CLASS_NAME not provided, ignore the whole process&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">resolved_index_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ctype</span> <span class="ow">in</span> <span class="n">class_name</span><span class="p">:</span>
            <span class="n">cell_node_line</span> <span class="o">=</span> <span class="n">cell_lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
            <span class="n">check_start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">exit_index</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">cell_node_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">check_start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">cell_node_line</span><span class="p">[</span><span class="n">cell_node_index</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">==</span> <span class="n">ctype</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ctype_start</span><span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">cell_node_index</span><span class="p">,</span> <span class="n">cell_node_line</span><span class="p">):</span>
                        <span class="n">cell_lineage</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ctype</span><span class="si">}</span><span class="s1">_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">=</span> <span class="n">cell_node_index</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="n">start_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cell_node_index_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">cell_node_line</span><span class="p">[</span><span class="n">cell_node_index_2</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">!=</span> <span class="n">ctype</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ctype_exit</span><span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">cell_node_index_2</span><span class="p">,</span> <span class="n">cell_node_line</span><span class="p">):</span>
                            <span class="n">cell_lineage</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ctype</span><span class="si">}</span><span class="s1">_exit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exit_index</span> <span class="o">=</span> <span class="n">cell_node_index_2</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="k">break</span>
            <span class="k">if</span> <span class="n">start_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">exit_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">exit_index</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_node_line</span><span class="p">)</span>
                <span class="n">resolved_index_map</span><span class="p">[</span><span class="n">ctype</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_index</span>
                <span class="k">for</span> <span class="n">cell_node_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                    <span class="n">cell_node_line</span><span class="p">[</span><span class="n">cell_node_index</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="n">ctype</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resolved_index_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resolved_index_map</span><span class="p">:</span>
                <span class="n">type_count</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">):</span>
                    <span class="n">type_count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span><span class="p">)</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">type_count</span><span class="p">)</span>
                <span class="n">resolved_type</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">):</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="n">resolved_type</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resolved_type</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">resolved_index_map</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">resolved_index_map</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)[:</span><span class="nb">min</span><span class="p">(</span><span class="n">resolved_index_map</span><span class="o">.</span><span class="n">values</span><span class="p">())]:</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="n">resolved_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_flag</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="pares_single_tree"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.pares_single_tree">[docs]</a><span class="k">def</span> <span class="nf">pares_single_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">TrackingTree</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">TreeParser</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">search_root_node</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">get_lineage_dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">)):</span>
        <span class="n">cell_lineage</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">lineage_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">[</span><span class="n">node_index</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">set_cell_id</span><span class="p">(</span><span class="n">cell_lineage</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">parser</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">[</span><span class="n">node_index</span><span class="p">],</span> <span class="n">lineage_index</span><span class="o">=</span><span class="n">node_index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># parser.parse_lineage_phase(cell_lineage, root=parser.root_parent_list[node_index], linage_index=node_index)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">smooth_type</span><span class="p">(</span><span class="n">cell_lineage</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">parser</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">[</span><span class="n">node_index</span><span class="p">],</span> <span class="n">lineage_index</span><span class="o">=</span><span class="n">node_index</span><span class="p">)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">set_cell_id</span><span class="p">(</span><span class="n">cell_lineage</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">parser</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">[</span><span class="n">node_index</span><span class="p">],</span> <span class="n">lineage_index</span><span class="o">=</span><span class="n">node_index</span><span class="p">)</span>
            <span class="c1"># print(cell_lineage)</span>
    <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="run_track"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.run_track">[docs]</a><span class="k">def</span> <span class="nf">run_track</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">track_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mcy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">speed_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">tracker</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">dic</span><span class="o">=</span><span class="n">dic</span><span class="p">,</span> <span class="n">mcy</span><span class="o">=</span><span class="n">mcy</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">track_range</span><span class="p">:</span>
        <span class="n">tracker</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">track_range</span><span class="p">,</span> <span class="n">speed_filename</span><span class="o">=</span><span class="n">speed_filename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tracker</span><span class="o">.</span><span class="n">track</span><span class="p">()</span>
    <span class="n">parser_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">tracker</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">pares_single_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="n">parser_dict</span><span class="p">[</span><span class="n">tree</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span>
    <span class="n">tracker</span><span class="o">.</span><span class="n">parser_dict</span> <span class="o">=</span> <span class="n">parser_dict</span>
    <span class="k">return</span> <span class="n">tracker</span></div>


<div class="viewcode-block" id="track_tree_to_table"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.track_tree_to_table">[docs]</a><span class="k">def</span> <span class="nf">track_tree_to_table</span><span class="p">(</span><span class="n">tracker</span><span class="p">:</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export track result to table&quot;&quot;&quot;</span>
    <span class="n">track_detail_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;frame_index&#39;</span><span class="p">,</span> <span class="s1">&#39;track_id&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_type&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;mask_of_x_points&#39;</span><span class="p">,</span> <span class="s1">&#39;mask_of_y_points&#39;</span><span class="p">]</span>
    <span class="n">track_detail_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">track_detail_columns</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_series</span><span class="p">(</span><span class="n">cell_lineage</span><span class="p">):</span>
        <span class="n">cell_nodes</span> <span class="o">=</span> <span class="n">cell_lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">cell_lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>
        <span class="n">series_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">before_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">cell_node_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cell_nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">before_node</span> <span class="o">=</span> <span class="n">cell_nodes</span><span class="p">[</span><span class="n">before_index</span><span class="p">]</span>
            <span class="n">current_node</span> <span class="o">=</span> <span class="n">cell_nodes</span><span class="p">[</span><span class="n">current_index</span><span class="p">]</span>
            <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">before_node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span> <span class="o">-</span> <span class="n">before_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">before_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span><span class="p">):</span>
                    <span class="c1"># gap_cell = deepcopy(before_node.cell)</span>
                    <span class="c1"># gap_cell.frame = frame</span>
                    <span class="n">gap_cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">before_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">cell_type</span><span class="o">=</span><span class="n">before_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span><span class="p">,</span>
                                    <span class="n">frame_index</span><span class="o">=</span><span class="n">frame</span><span class="p">)</span>
                    <span class="n">gap_cell</span><span class="o">.</span><span class="n">set_track_id</span><span class="p">(</span><span class="n">before_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">track_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">gap_cell</span><span class="o">.</span><span class="n">set_cell_id</span><span class="p">(</span><span class="n">before_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_id</span><span class="p">)</span>
                    <span class="n">gap_cell</span><span class="o">.</span><span class="n">set_branch_id</span><span class="p">(</span><span class="n">before_node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">branch_id</span><span class="p">)</span>
                    <span class="n">gap_node</span> <span class="o">=</span> <span class="n">CellNode</span><span class="p">(</span><span class="n">gap_cell</span><span class="p">)</span>
                    <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gap_node</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">current_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">before_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">current_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># for node in cell_nodes:</span>
        <span class="c1"># print(new_nodes)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">new_nodes</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">track_id</span><span class="p">,</span>
                   <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span>
                   <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                   <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span><span class="p">,</span>
                   <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">track_detail_columns</span><span class="p">,</span> <span class="n">col</span><span class="p">)))</span>
            <span class="n">series_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">series_list</span><span class="p">,</span> <span class="n">new_nodes</span>

    <span class="n">parser_dict</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">parser_dict</span>
    <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">parser_dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">track_id</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">parser_dict</span><span class="p">[</span><span class="n">tree</span><span class="p">]</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parser_dict</span><span class="p">[</span><span class="n">tree</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">:</span>
            <span class="n">cell_lineage</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">lineage_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node_index</span><span class="p">)</span>
            <span class="n">series_list</span><span class="p">,</span> <span class="n">new_node_list</span> <span class="o">=</span> <span class="n">generate_series</span><span class="p">(</span><span class="n">cell_lineage</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">series_list</span><span class="p">:</span>
                <span class="n">track_detail_dataframe</span> <span class="o">=</span> <span class="n">track_detail_dataframe</span><span class="o">.</span><span class="n">_append</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="n">track_detail_dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="track_trees_to_json"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.track_trees_to_json">[docs]</a><span class="k">def</span> <span class="nf">track_trees_to_json</span><span class="p">(</span><span class="n">tracker</span><span class="p">:</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">output_fname</span><span class="p">,</span> <span class="n">xrange</span><span class="p">,</span> <span class="n">basename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export track result to json file&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">basename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;mcy&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">basename</span>

    <span class="k">def</span> <span class="nf">update_region</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="c1"># print(type(node))</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">region</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_type</span>
        <span class="n">track_id</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">track_id</span>
        <span class="n">cell_id</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_id</span>
        <span class="n">region</span><span class="p">[</span><span class="s1">&#39;region_attributes&#39;</span><span class="p">][</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="n">region</span><span class="p">[</span><span class="s1">&#39;region_attributes&#39;</span><span class="p">][</span><span class="s1">&#39;track_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_id</span>
        <span class="n">region</span><span class="p">[</span><span class="s1">&#39;region_attributes&#39;</span><span class="p">][</span><span class="s1">&#39;cell_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_id</span>
        <span class="n">region</span><span class="p">[</span><span class="s1">&#39;region_attributes&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_id</span>
        <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_region</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">frame_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xrange</span><span class="p">):</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">image_name</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">image_name</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">RAW_INPUT_IMAGE_SIZE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">RAW_INPUT_IMAGE_SIZE</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s2">&quot;regions&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;file_attributes&quot;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">result</span><span class="p">[</span><span class="n">image_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">image_name</span><span class="p">])</span>
        <span class="n">frame_map</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_name</span>
        <span class="k">del</span> <span class="n">tmp</span>
    <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">tracker</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">all_nodes</span><span class="p">():</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span>
            <span class="n">update_region</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">region</span>
            <span class="n">image_name</span> <span class="o">=</span> <span class="n">frame_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">image_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tmp_frame</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>
                <span class="n">tmp_frame</span><span class="p">[</span><span class="s1">&#39;regions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>


<div class="viewcode-block" id="track_tree_to_TRA"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.track_tree_to_TRA">[docs]</a><span class="k">def</span> <span class="nf">track_tree_to_TRA</span><span class="p">(</span><span class="n">tracker</span><span class="p">:</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">output_fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xrange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">basename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export track result as TRA format&quot;&quot;&quot;</span>

    <span class="n">TRA</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">parser_dict</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">parser_dict</span>
    <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">parser_dict</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parser_dict</span><span class="p">[</span><span class="n">tree</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">:</span>
            <span class="n">cell_lineage</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">lineage_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node_index</span><span class="p">)</span>
            <span class="n">cells</span> <span class="o">=</span> <span class="n">cell_lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">cell_lineage</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span>
            <span class="n">branch_id</span> <span class="o">=</span> <span class="n">cell_lineage</span><span class="p">[</span><span class="s1">&#39;branch_id&#39;</span><span class="p">]</span>
            <span class="n">L</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span>
            <span class="n">E</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span>
            <span class="k">if</span> <span class="n">branch_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">B</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">E</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">P</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">TRA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">output_fname</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">TRA</span><span class="p">)</span></div>


<div class="viewcode-block" id="track_tree_to_mask"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.track_tree_to_mask">[docs]</a><span class="k">def</span> <span class="nf">track_tree_to_mask</span><span class="p">(</span><span class="n">tracker</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">):</span>
    <span class="n">parser_dict</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">parser_dict</span>
    <span class="n">cell_each_frame</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {frame: cell_list}</span>
    <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">parser_dict</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parser_dict</span><span class="p">[</span><span class="n">tree</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">root_parent_list</span><span class="p">:</span>
            <span class="n">cell_lineage</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">lineage_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node_index</span><span class="p">)</span>
            <span class="n">cells</span> <span class="o">=</span> <span class="n">cell_lineage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cell_each_frame</span><span class="p">:</span>
                    <span class="n">cell_each_frame</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell</span><span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cell_each_frame</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">cell_each_frame</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mask&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.tif&quot;</span><span class="p">)</span>
        <span class="n">mask_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_each_frame</span><span class="p">[</span><span class="n">frame</span><span class="p">]:</span>
            <span class="n">contours</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">contours</span>
            <span class="n">L</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">mask_arr</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="p">(</span><span class="n">L</span><span class="p">))</span>
        <span class="n">tifffile</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mask_arr</span><span class="p">)</span></div>



<div class="viewcode-block" id="run"><a class="viewcode-back" href="../../python_apis/SCTrack.reclassification.html#SCTrack.reclassification.run">[docs]</a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">track_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_visualize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visualize_background_image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mcy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">track_to_json</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">track_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">annotation</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;annotation type error </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">xrange</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xrange</span> <span class="o">=</span> <span class="n">track_range</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">RECORD_SPEED</span><span class="p">:</span>
        <span class="n">speed_output_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;track_speed.csv&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">speed_output_filename</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tracker</span> <span class="o">=</span> <span class="n">run_track</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">track_range</span><span class="o">=</span><span class="n">xrange</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dic</span><span class="o">=</span><span class="n">dic</span><span class="p">,</span> <span class="n">mcy</span><span class="o">=</span><span class="n">mcy</span><span class="p">,</span> <span class="n">speed_filename</span><span class="o">=</span><span class="n">speed_output_filename</span><span class="p">)</span>
    <span class="n">track_table_fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;track.csv&#39;</span><span class="p">)</span>
    <span class="n">track_visualization_fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;track_visualization.tif&#39;</span><span class="p">)</span>
    <span class="n">track_json_fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;result_with_track.json&#39;</span><span class="p">)</span>
    <span class="n">tracktree_save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;TrackTree&#39;</span><span class="p">)</span>
    <span class="n">track_tree_to_table</span><span class="p">(</span><span class="n">tracker</span><span class="p">,</span> <span class="n">track_table_fname</span><span class="p">)</span>
    <span class="n">tracker</span><span class="o">.</span><span class="n">track_tree_to_json</span><span class="p">(</span><span class="n">tracktree_save_path</span><span class="p">)</span>
    <span class="n">track_tree_to_TRA</span><span class="p">(</span><span class="n">tracker</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;TRA.txt&#39;</span><span class="p">))</span>
    <span class="n">image_width</span><span class="p">,</span> <span class="n">image_height</span> <span class="o">=</span> <span class="n">imagesize</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mcy</span><span class="p">)</span>
    <span class="n">track_tree_to_mask</span><span class="p">(</span><span class="n">tracker</span><span class="p">,</span> <span class="n">image_width</span><span class="p">,</span> <span class="n">image_height</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;mask&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">track_to_json</span><span class="p">:</span>
        <span class="n">track_trees_to_json</span><span class="p">(</span><span class="n">tracker</span><span class="p">,</span> <span class="n">track_json_fname</span><span class="p">,</span> <span class="n">xrange</span><span class="o">=</span><span class="n">xrange</span><span class="p">,</span> <span class="n">basename</span><span class="o">=</span><span class="n">basename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_visualize</span><span class="p">:</span>
        <span class="n">tracker</span><span class="o">.</span><span class="n">visualize_to_tif</span><span class="p">(</span><span class="n">visualize_background_image</span><span class="p">,</span> <span class="n">track_visualization_fname</span><span class="p">,</span> <span class="n">tracker</span><span class="o">.</span><span class="n">trees</span><span class="p">,</span> <span class="n">xrange</span><span class="o">=</span><span class="n">xrange</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># annotation = r&#39;G:\æ‚é¡¹\example\example-annotation.json&#39;</span>
    <span class="c1"># mcy_img = r&#39;G:\æ‚é¡¹\example\example-image.tif&#39;</span>
    <span class="c1"># dic_img = r&#39;G:\æ‚é¡¹\example\example-bf.tif&#39;</span>
    <span class="n">annotation</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;G:\CTC dataset\Fluo-N2DL-HeLa\Fluo-N2DL-HeLa\01_ST\test.json&quot;</span>
    <span class="n">mcy_img</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;G:\CTC dataset\Fluo-N2DL-HeLa\Fluo-N2DL-HeLa\01_ST\SEG.tif&quot;</span>
    <span class="n">dic_img</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;G:\CTC dataset\Fluo-N2DL-HeLa\Fluo-N2DL-HeLa\01_ST\SEG.tif&quot;</span>
    <span class="c1"># tracker = run_track(r&#39;G:\paper\evaluate_data\copy_of_1_xy10\result-GT.json&#39;, track_range=10)</span>
    <span class="c1"># tracker = run_track(annotation, track_range=30)</span>
    <span class="c1"># background_filename_list = [os.path.join(r&#39;G:\paper\evaluate_data\copy_of_1_xy10\tif-seq&#39;, i) for i in</span>
    <span class="c1">#                             os.listdir(r&#39;G:\paper\evaluate_data\copy_of_1_xy10\tif-seq&#39;)]</span>
    <span class="c1"># print(background_filename_list)</span>
    <span class="c1"># for i in tracker.trees:</span>
    <span class="c1">#     print(i)</span>
    <span class="c1"># tracker.visualize_single_tree(tree=tracker.trees[51],</span>
    <span class="c1">#                               save_dir=r&#39;G:\paper\evaluate_data\copy_of_1_xy10\single_tree_visualize&#39;,</span>
    <span class="c1">#                               background_filename_list=background_filename_list, xrange=10)</span>

    <span class="n">run</span><span class="p">(</span><span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;G:\CTC dataset\Fluo-N2DL-HeLa\Fluo-N2DL-HeLa\01_ST&quot;</span><span class="p">,</span>
        <span class="n">track_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mcy</span><span class="o">=</span><span class="n">mcy_img</span><span class="p">,</span>
        <span class="n">save_visualize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visualize_background_image</span><span class="o">=</span><span class="n">mcy_img</span><span class="p">,</span>
        <span class="n">track_to_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">basename</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;man_seg&#39;</span><span class="p">)</span>
</pre></div>

          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2023, Li Chengxin.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.2.1 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>